<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace 필수 설정! -->
<mapper namespace="kr.co.coduck.dao.ReviewDao">

	<select id="getAllReivewStarAvg" parameterType="int" resultType="ReviewStarDto">
		with temp as (
		    select 
		    	r.review_star, count(*)  count
		    from
		     	reviews r, ord_lect_infos o 
		    where
		     	r.ord_lect_no = o.ord_lect_no 
		    and o.lect_no = #{value}
		    group by 
		    	r.review_star)
		select 
			review_star		star
			, count		
			, trunc(count*100/(select sum(count) from temp)) avgStar
		from 
			temp
		group by 
			review_star, count

		    
	</select>	
	
	
</mapper>